---
- name: Check value of NetVM for {{ item }}
  command: qvm-prefs --get {{ item }} netvm
  register: netvm_pref
  changed_when: false

- name: Set new value of NetVM for {{ item }} if necessary
  command: qvm-prefs --set {{ item }} netvm {{ hostvars[item]['_netvm'] | default('None') }}
  when: netvm_pref.stdout != hostvars[item]['_netvm']
