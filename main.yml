---
- name: Prepare connection and variables
  hosts: "{{ lookup('env', 'MOLECULE_GROUP') | default('all', true) }}"
  gather_facts: true
  roles:
    - roles/system/prepare
    - roles/system/connect

- name: Provision the firewall and network controller
  hosts: pfsense
  roles:
    - roles/misc/pfsense

- name: Setup the IDS
  hosts: seconion
  roles:
    - roles/misc/seconion

- name: Setup VM controller and network
  hosts: maas
  roles:
    - roles/misc/maas

- name: Install desktop software
  hosts: "{{ lookup('env', 'MOLECULE_GROUP') | default('desktop', true) }}"
  roles:
    - roles/tools/vim
    - roles/tools/wails
    - roles/tools/watchman
    - roles/tools/waypoint
    - roles/tools/wget
    - roles/tools/windowsadmincenter
    - roles/tools/windowspowertoys
    - roles/tools/wkhtmltopdf
    - roles/tools/wpcli
    - roles/tools/wrk
    - roles/tools/yank
    - roles/tools/yarn
    - roles/tools/yubikey
    - roles/tools/zoxide
    - roles/crypto/ledgerlive
    - roles/crypto/monero
    - roles/services/googleassistant
    - roles/services/guacamole
    - roles/services/portmaster
    - roles/services/snitch
    - roles/system/extensions
    - roles/system/santa
    - roles/system/desktop
    - roles/system/ulauncher

- name: Finish configuring systems
  hosts: "{{ lookup('env', 'MOLECULE_GROUP') | default('all:!pfsense:!seconion', true) }}"
  roles:
    # - roles/misc/easyengine
    # - roles/misc/hosthomepage
    - roles/system/mackup
    - roles/system/finish
