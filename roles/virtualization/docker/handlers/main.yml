---
- name: restart docker
  become: true
  service:
    name: docker
    state: '{{ docker_restart_handler_state }}'
  when:
    - ansible_os_family not in ('Windows', 'Darwin')
    - not ("'WSLENV' in ansible_env or 'microsoft' in ansible_kernel or 'WSL' in ansible_kernel")

- name: reload systemd daemon
  become: true
  systemd:
    daemon_reload: true
  when:
    - ansible_os_family not in ('Windows', 'Darwin')
    - not ("'WSLENV' in ansible_env or 'microsoft' in ansible_kernel or 'WSL' in ansible_kernel")

- name: restart containerd
  become: true
  systemd:
    name: containerd
    state: restarted
  when: not ("'WSLENV' in ansible_env or 'microsoft' in ansible_kernel or 'WSL' in ansible_kernel")
