---
- name: "Ensure VirtualBox machine folder is location is configured"
  become_user: "{{ user.username }}"
  lineinfile:
    path: ~/.config/VirtualBox/VirtualBox.xml
    backrefs: true
    regex: '(^    <SystemProperties )(defaultMachineFolder="\S*")( .*$)'
    line: '\1 defaultMachineFolder="/home/{{ user.username }}/.virtualbox" \3'
    mode: 0700
  when: ansible_system == 'Linux'

- name: "Ensure VirtualBox machine folder is location is configured"
  become_user: "{{ user.username }}"
  lineinfile:
    path: ~/Library/VirtualBox/VirtualBox.xml
    backrefs: true
    regex: '(^    <SystemProperties )(defaultMachineFolder="\S*")( .*$)'
    line: '\1 defaultMachineFolder="/Users/{{ user.username }}/.virtualbox" \3'
    mode: 0700
  when: ansible_system != 'Linux'
