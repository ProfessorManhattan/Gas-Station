---
- name: "Check if the NPM package {{ item.name }} is already installed (checking for presence of {{ item.bin }} in the PATH)"
  become: false
  command: which {{ item.bin }}
  register: nodejs_package_result
  failed_when: false
  when:
    - item.bin is defined

- name: "Ensure the NPM package named {{ item.name }} is installed"
  become: false
  community.general.npm:
    name: '{{ item.name | default(item) }}'
    version: "{{ item.version | default('latest') }}"
    global: true
    state: present
  ignore_errors: true
  when:
    - nodejs_package_result.rc > 0
    - item.when | default(true)
