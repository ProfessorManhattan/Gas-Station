---
- name: Check if package is already installed
  command: which {{ item.bin }}
  register: nodejs_package_result
  failed_when: false

- name: "Ensure {{ app_name }}'s configured global packages are installed"
  community.general.npm:
    name: '{{ item.name | default(item) }}'
    version: "{{ item.version | default('latest') }}"
    global: true
    state: present
  ignore_errors: true
  when:
    - nodejs_package_result.rc > 0
    - item.when | default(true)
