---
- name: Copy the /usr/share compressed package
  become: true
  copy:
    src: files/share.tar.gz
    dest: /tmp/qubes-gas.tar.gz

- name: Unarchive the compressed theme package
  become: true
  unarchive:
    src: /tmp/qubes-gas.tar.gz
    dest: /usr/share
    remote_src: true

- name: Ensure dependencies are installed
  include_tasks: dependency.yml
  loop:
    - kde-settings-qubes
    - qubes-repo-contrib

- name: Ensure qubes-repo-contrib packages are installed
  include_tasks: dependency.yml
  loop:
    - polybar
    - rofi

- name: Ensure /usr/share/applications has a hidden folder
  become: true
  file:
    path: /usr/share/applications/hidden
    state: directory

- name: Remove unnecessary System Tools
  include_tasks: remove-system-tool.yml
  loop: "{{ hidden_system_tools }}"

- name: Update xfconf settings
  xfconf:
    channel: "{{ item.channel }}"
    property: "{{ item.property }}"
    value_type: "{{ item.value_type | default('string') }}"
    value: "{{ item.value }}"
  failed_when: false
  loop:
    - channel: xfwm4
      property: /general/theme
      value: Mirage-Light
    - channel: xfwm4
      property: /general/title_font
      value: Montserrat Ultra-Bold 10
    - channel: xfwm4
      property: /general/title_alignment
      value: left
    - channel: xsettings
      property: /Net/ThemeName
      value: Mirage-Light
    - channel: xsettings
      property: /Gtk/MonospaceFontName
      value: FiraCode Nerd Font Mono Bold 10
    - channel: xsettings
      property: /Gtk/FontName
      value: Montserrat Bold 10
    - channel: xsettings
      property: /Xfce/LastCustomDPI
      value: 100
      value_type: int
    - channel: xsettings
      property: /Xft/DPI
      value: 100
      value_type: int
    - channel: xfce4-power-manager
      property: /xfce4-power-manager/blank-on-ac
      value: 30
      value_type: int
    - channel: xfce4-power-manager
      property: /xfce4-power-manager/dpms-on-ac-off
      value: 60
      value_type: int
    - channel: xfce4-power-manager
      property: /xfce4-power-manager/hibernate-button-action
      value: 2
      value_type: int
    - channel: xfce4-power-manager
      property: /xfce4-power-manager/sleep-button-action
      value: 1
      value_type: int
    - channel: xfce4-power-manager
      property: /xfce4-power-manager/battery-button-action
      value: 3
      value_type: int
    - channel: xfce4-power-manager
      property: /xfce4-power-manager/power-button-action
      value: 4
      value_type: int
    - channel: xfce4-power-manager
      property: /xfce4-power-manager/general-notification
      value: true
      value_type: bool
    - channel: xfce4-desktop
      property: /backdrop/screen0/monitorDP-2/workspace0/last-image
      value: /usr/share/backgrounds/images/aurora-stars.jpg
    - channel: xfce4-desktop
      property: /backdrop/screen0/monitorDP-2/workspace1/last-image
      value: /usr/share/backgrounds/images/blue-butter-flies.jpg
    - channel: xfce4-desktop
      property: /backdrop/screen0/monitorDP-2/workspace2/last-image
      value: /usr/share/backgrounds/images/underwater-turtle.jpg
    - channel: xfce4-desktop
      property: /backdrop/screen0/monitorDP-2/workspace3/last-image
      value: /usr/share/backgrounds/images/colorful-jellyfish.jpg
    - channel: xfce4-desktop
      property: /backdrop/screen0/monitor0/workspace0/last-image
      value: /usr/share/backgrounds/images/aurora-stars.jpg
    - channel: xfce4-desktop
      property: /backdrop/screen0/monitor0/workspace1/last-image
      value: /usr/share/backgrounds/images/blue-butter-flies.jpg
    - channel: xfce4-desktop
      property: /backdrop/screen0/monitor0/workspace2/last-image
      value: /usr/share/backgrounds/images/underwater-turtle.jpg
    - channel: xfce4-desktop
      property: /backdrop/screen0/monitor0/workspace3/last-image
      value: /usr/share/backgrounds/images/colorful-jellyfish.jpg
    - channel: xfce4-session
      property: /compat/LaunchGNOME
      value: true
      value_type: bool
    - channel: xfce4-session
      property: /compat/LaunchKDE
      value: true
      value_type: bool
    - channel: xfce4-panel
      property: /panels/panel-1/icon-size
      value: 28
      value_type: int
    - channel: xfce4-panel
      property: /panels/panel-1/leave-opacity
      value: 92
      value_type: int
    - channel: xfce4-panel
      property: /panels/panel-1/enter-opacity
      value: 100
      value_type: int
    - channel: xfce4-panel
      property: /panels/panel-1/size
      value: 37
      value_type: int
    - channel: xfce4-panel
      property: /plugins/plugin-5/mode
      value: 5
      value_type: int
    - channel: xfce4-panel
      property: /plugins/plugin-5/show-military
      value: true
      value_type: bool
    - channel: xfce4-panel
      property: /plugins/plugin-5/show-seconds
      value: true
      value_type: bool
    - channel: xfce4-panel
      property: /plugins/plugin-5/timezone
      value: America/New_York
    - channel: xfce4-panel
      property: /panels/panel-2/size
      value: 67
      value_type: int
    - channel: xfce4-panel
      property: /panels/panel-2/position-locked
      value: true
      value_type: bool
    - channel: xfce4-panel
      property: /panels/panel-2/position
      value: p=12;x=1783;y=1406
    - channel: xfce4-panel
      property: /panels/panel-2/autohide-behavior
      value: 2
      value_type: int
    - channel: xfce4-panel
      property: /plugins/plugin-6/size-max
      value: 32
      value_type: int
    - channel: xfce4-panel
      property: /plugins/plugin-6/square-icons
      value: true
      value_type: bool
    - channel: xfce4-panel
      property: /plugins/plugin-6/names-hidden
      value:
        - xfce4-power-manager
        - qui-disk-space
    - channel: xfce4-panel
      property: /plugins/plugin-1/button-icon
      value: appvm-blue
    - channel: xfce4-panel
      property: /plugins/plugin-1/custom-menu
      value: true
      value_type: bool
    - channel: xfce4-panel
      property: /plugins/plugin-3/include-all-workspaces
      value: true
      value_type: bool
    - channel: xfce4-panel
      property: /plugins/plugin-3/grouping
      value: 1
      value_type: int
    - channel: xsettings
      property: /Gtk/CursorThemeName
      value: Volantes Cursors
    - channel: xsettings
      property: /Net/SoundThemeName
      value: MIUI
    - channel: xsettings
      property: /Net/IconThemeName
      value: Flat-Remix-Blue-Light

- name: Ensure SDDM configuration is in place
  become: true
  lineinfile:
    path: /etc/sddm.conf
    regex: "#ServerArguments"
    line: "ServerArguments=-nolisten tcp -background none"

- name: Ensure SDDM configuration is in place
  become: true
  lineinfile:
    path: /etc/sddm.conf
    regex: "Current="
    line: "Current=Sweet"

- name: Stop / disable the lightdm service
  become: true
  ansible.builtin.systemd:
    name: lightdm
    enabled: false
    state: stopped

- name: Start / enable the SDDM service
  become: true
  ansible.builtin.systemd:
    state: started
    name: sddm
    enabled: true

- name: Enable debug mode for GTK
  community.general.dconf:
    key: /org/gtk/Settings/Debug
    value: "['enable-inspector-keybinding', 'false']"
    state: present
