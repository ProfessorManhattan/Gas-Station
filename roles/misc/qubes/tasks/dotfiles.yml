---
- name: Check if dotfiles have already been installed
  stat:
    path: ~/.local/bin/install-dotfiles
  register: dotfiles_local_bin

- name: Run the dotfiles installer (if it has not already been run)
  shell:
    cmd: |
      qvm-create --label red --template debian-11 provision &> /dev/null || EXIT_CODE=$?
      qvm-run --pass-io provision 'curl -sSL {{ dotfiles_installer_script }}' > /tmp/dotfiles.sh
      bash /tmp/dotfiles.sh
  when: not dotfiles_local_bin.stat.exists
