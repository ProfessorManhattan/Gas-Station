---
- name: Copy the GRUB /usr/share folder with theme
  become: true
  copy:
    src: files/share/grub/
    dest: /usr/share/grub/

- name: Ensure /boot/grub2/themes is a directory
  become: true
  file:
    path: /boot/grub2/themes
    state: directory

- name: Symlink /usr/share/grub/themes/Mirage to /boot/grub2/themes/Mirage
  ansible.builtin.file:
    src: /usr/share/grub/themes/Mirage
    dest: /boot/grub2/themes/Mirage
    owner: foo
    group: foo
    state: link

- name: Optimize the GRUB resolution
  lineinfile:
    path: /etc/default/grub
    regex: "GRUB_GFXMODE="
    line: "GRUB_GFXMODE={{ qubes_grub_gfxmode }},auto"
  notify: update grub

- name: Ensure GRUB_GFXPAYLOAD_LINUX is set
  lineinfile:
    path: /etc/default/grub
    regex: "GRUB_GFXPAYLOAD_LINUX="
    line: 'GRUB_GFXPAYLOAD_LINUX="keep"'
  notify: update grub

- name: Ensure GRUB is using the Mirage theme
  lineinfile:
    path: /etc/default/grub
    regex: "GRUB_THEME="
    line: 'GRUB_THEME="/boot/grub2/themes/Mirage/theme.txt"'
  notify: update grub
