---
- name: Download the git repository asset
  shell:
    cmd: |
      qvm-create --label red --template debian-11 download-vm || EXIT_CODE=$?
      qvm-run download-vm 'curl -sSL {{ linux_theme_package }}?path=share/plymouth > /home/user/plymouth.tar.gz'
      qvm-run --pass-io download-vm 'cat /home/user/plymouth.tar.gz' > "/tmp/plymouth.tar.gz"

- name: Ensure latest Plymouth theme files are present on system
  become: true
  ansible.builtin.unarchive:
    src: /tmp/plymouth.tar.gz
    dest: /usr/share/plymouth/
    remote_src: true

- name: Register the Plymouth theme
  become: true
  alternatives:
    name: default.plymouth
    link: /usr/share/plymouth/themes/default.plymouth
    path: /usr/share/plymouth/themes/polaroid/polaroid.plymouth"
    priority: 100

- name: Set the Plymouth theme
  become: true
  shell: plymouth-set-default-theme polaroid
  notify: update initramfs
