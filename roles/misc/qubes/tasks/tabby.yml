---
- name: Ensure "untrusted" binary assets are available
  vars:
    file_name: "{{ qubes_tabby_terminal_rpm_file }}"
  include_tasks: untrusted-download.yml

- name: Ensure Tabby is installed in dom0
  become: true
  dnf:
    name: /usr/local/src/qubes-dom0-binaries/{{ qubes_tabby_terminal_rpm_file }}
    state: present
    disable_gpg_check: true

- name: Update XFCE4 default application for Terminal
  become: true
  lineinfile:
    path: /etc/xdg/xfce4/helpers.rc
    regex: "FileManager="
    line: "TerminalEmulator=tabby-terminal"

- name: Configure gsettings for Tabby
  command: |
    gsettings set org.gnome.desktop.default-applications.terminal exec /usr/bin/tabby
    gsettings set org.gnome.desktop.default-applications.terminal exec-arg "-x"
