---
- name: "Check gsetting (gsettings get {{ item.setting }})"
  become: true
  become_user: "{{ dom0_user }}"
  become_method: su
  become_flags: "--login"
  command: "gsettings get {{ item.setting }}"
  register: gsettings_get_command
  changed_when: false
  ignore_errors: true

- name: "Apply gsetting (gsettings set)"
  become: true
  become_user: "{{ dom0_user }}"
  become_method: su
  become_flags: "--login"
  command: gsettings set {{ item.setting }} {{ item.value }}
  when:
    - gsettings_get_command.stdout != item.value
    - item.value not in gsettings_get_command.stdout
  ignore_errors: true
