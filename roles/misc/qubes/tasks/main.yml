---
- name: Set timezone
  become: true
  command: timedatectl set-timezone {{ timezone }}
  when: timezone is defined

- name: Configure TemplateVM / dom0 updates to use Tor
  include_tasks: tor-updates.yml
  when: 'tor-updates' in dom0_features

- name: Ensure dom0 and TemplateVMs are up-to-date
  include_tasks: update.yml
  when: 'update' in dom0_features

- name: Ensure sys-usb and related policies are setup
  include_tasks: usb.yml
  when: 'sys-usb' in dom0_features

- name: Ensure official templates are available
  include_tasks: templates.yml
  loop: qubes_templates
  loop_control:
    loop_var: template

- name: Setup the split GPG feature (qubes-gpg-split-dom0)
  include_tasks: split-gpg.yml
  when: 'split-gpg' in dom0_features

- name: Setup the U2F feature (qubes-u2f-dom0)
  include_tasks: u2f.yml
  when: 'u2f' in dom0_features

- name: Setup YubiKey integration (qubes-yubikey-dom0)
  include_tasks: yubikey.yml
  when: 'yubikey' in dom0_features

- name: Force prompt when using sudo in AppVMs
  include_tasks: sudo-prompt.yml
  when: 'sudo-prompt' in dom0_features
