---
- name: Ensure the SDDM configuration has the correct ServerArguments
  lineinfile:
    path: /etc/sddm.conf
    regex: "#ServerArguments"
    line: "ServerArguments=-nolisten tcp -background none"

- name: Ensure the SDDM configuration has the correct Current theme
  lineinfile:
    path: /etc/sddm.conf
    regex: "Current="
    line: "Current={{ theme_name }}"

- name: Add a custom wayland-session script to load {{ theme_name }} theme prior to display
  copy:
    src: files/wayland-session.sh
    dest: /etc/sddm/wayland-session
    mode: '0755'

- name: Stop / disable the lightdm service
  ansible.builtin.systemd:
    name: lightdm
    enabled: false
    state: stopped

- name: Start / enable the SDDM service
  ansible.builtin.systemd:
    state: started
    name: sddm
    enabled: true
