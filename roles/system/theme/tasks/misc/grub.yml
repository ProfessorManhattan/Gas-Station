---
- name: Copy over GRUB theme files from the theme folder in /usr/share/grub/themes
  copy:
    src: /usr/src/{{ theme_slug }}/share/grub/themes/
    dest: /usr/share/grub/themes/
    remote_src: true

- name: Ensure /boot/grub2/themes is a directory
  file:
    path: /boot/grub2
    state: directory

- name: Copy /usr/share/grub/themes to /boot/grub2/themes
  copy:
    src: /usr/share/grub/themes/
    dest: /boot/grub2/themes/
    remote_src: true
  notify: update grub

- name: Detect optimal value for GRUB_GFXMODE
  command: echo TODO

# @action Ensures GRUB is configured
# Configures GRUB timeout
- name: Set GRUB timeout
  lineinfile:
    path: /etc/default/grub
    regex: 'GRUB_TIMEOUT='
    line: 'GRUB_TIMEOUT={{ grub_timeout }}'
  notify: update grub

# @action Ensures GRUB is configured
# Optimizes GRUB resolution
- name: Optimize the GRUB resolution
  lineinfile:
    path: /etc/default/grub
    regex: 'GRUB_GFXMODE='
    line: 'GRUB_GFXMODE={{ grub_gfxmode }},auto'
  notify: update grub

- name: Ensure GRUB_GFXPAYLOAD_LINUX is set
  lineinfile:
    path: /etc/default/grub
    regex: 'GRUB_GFXPAYLOAD_LINUX='
    line: 'GRUB_GFXPAYLOAD_LINUX="keep"'
  notify: update grub

# @action Ensures GRUB is configured
# Applies the GRUB theme
- name: Ensure GRUB is using the Mirage theme
  lineinfile:
    path: /etc/default/grub
    regex: 'GRUB_THEME='
    line: 'GRUB_THEME="/boot/grub2/themes/{{ theme_slug }}/theme.txt"'
  notify: update grub
