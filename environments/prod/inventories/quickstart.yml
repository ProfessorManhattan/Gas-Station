---
# Three hosts are defined but the quickstart script filters using an environment variable
# so only one host is provisioned at a time by quickstart.
all:
  vars:
    ansible_password: "{{ lookup('env', 'ANSIBLE_PASSWORD') }}"
    ansible_user: "{{ lookup('env', 'ANSIBLE_USER') }}"
    ansible_winrm_transport: credssp
    ansible_winrm_server_cert_validation: ignore
  children:
    desktop:
      children:
        nix:
          hosts:
            standard:
              ansible_connection: local
        qubes:
          vars:
            ansible_python_interpreter: /usr/bin/python3
            qubes:
              dom0_vm: dom0
          hosts:
            dom0:
              ansible_connection: qubes
          children:
            vms:
              vars:
                ansible_connection: qubes
                mem: 2048
                maxmem: 4096
                memory: 512
                vcpus: 2
              children:
                appvms:
                netvms:
                proxyvms:
                standalonevms:
                templatevms:
                systemvms:
        windows:
          hosts:
            standard:
              ansible_connection: winrm

appvms:
  vars:
    qubes:
      maxmem: 2048
      mem: 2048
      memory: 512
      vm_type: AppVM
  children:
    primarydvms:
      vars:
        qubes:
          label: green
          netvm: sys-firewall
          services:
            appmenus-dispvm: true
            vm-boot-protect: true
            vm-boot-protect-root: false
          template_for_dispvms: true
      hosts:
        debian-11-dvm:
          qubes:
            template: debian-11
            template_vm: debian-11
        debian-11-minimal-dvm:
          qubes:
            template: debian-11-minimal
            template_vm: debian-11-minimal
        fedora-36-dvm:
          qubes:
            template: fedora-36
            template_vm: fedora-36
        fedora-36-minimal-dvm:
          qubes:
            template: fedora-36-minimal
            template_vm: fedora-36-minimal
    uservms:
      hosts:
        crypto:
          qubes:
            netvm: vpn-proton
            netvm_vm: vpn-proton
        development:
          qubes:
            maxmem: 8192
            netvm: vpn-proton
            netvm_vm: vpn-proton
            vcpus: 4
          volume:
            private: 40g
            root: 40g
        gpg:
          qubes:
            label: green
            template: fedora-36-minimal
            template_vm: fedora-36-minimal
        kubernetes:
          qubes:
            autostart: true
            maxmem: 8192
            netvm: vpn-pritunl
            netvm_vm: vpn-pritunl
            vcpus: 4
            vm_type: NetVM
          volume:
            root: 100g
        media:
          qubes:
            netvm: vpn-proton
            netvm_vm: vpn-proton
          volume:
            private: 100g
            root: 10g
        personal:
          qubes:
            maxmem: 8192
            netvm: sys-firewall
            netvm_vm: vpn-proton
            vcpus: 4
          volume:
            private: 20g
            root: 40g
        provision:
          qubes:
            netvm: vpn-pritunl
            netvm_vm: vpn-pritunl
        remote:
          qubes:
            netvm: vpn-pritunl
            netvm_vm: vpn-pritunl
        swarm:
          qubes:
            autostart: true
            maxmem: 8192
            netvm: vpn-pritunl
            netvm_vm: vpn-pritunl
            vcpus: 4
        vault:
          qubes:
            label: green
            template: fedora-36-minimal
            template_vm: fedora-36-minimal
        work:
          qubes:
            maxmem: 8192
            netvm: vpn-pritunl
            netvm_vm: vpn-pritunl
            vcpus: 4
          volume:
            private: 40g
            root: 40g
      vars:
        qubes:
          label: black
          services:
            vm-boot-protect-root: true
          template: fedora-36
          template_vm: fedora-36

netvms:
  hosts:
    opnsense:
      ansible_password: "{{ lookup('env', 'OPNSENSE_PASSWORD') }}"
      ansible_user: "{{ lookup('env', 'OPNSENSE_USER') }}"
      qubes:
        provides_network: true
        template: opnsense-template
        template_vm: opnsense-template
      volume:
        root: 40g
    seconion:
      ansible_password: "{{ lookup('env', 'SECONION_PASSWORD') }}"
      ansible_user: "{{ lookup('env', 'SECONION_USER') }}"
      qubes:
        template: seconion-template
        template_vm: seconion-template
      volume:
        root: 400g
  vars:
    ansible_connection: ssh
    qubes:
      autostart: true
      label: black
      mem: 4096
      memory: 8192
      maxmem: 8192
      virt_mode: hvm
      vm_type: NetVM

proxyvms:
  hosts:
    vpn-mullvad:
      qubes:
        netvm: sys-firewall
        netvm_vm: sys-firewall
    vpn-pritunl:
      qubes:
        netvm: opnsense
        netvm_vm: opnsense
    vpn-proton:
      qubes:
        netvm: sys-firewall
        netvm_vm: sys-firewall
  vars:
    qubes:
      autostart: true
      services:
        vm-boot-protect: true
      label: black
      mem: 512
      memory: 256
      maxmem: 1024
      template: vpn-template
      template_vm: vpn-template
      vcpus: 1
      vm_type: ProxyVM
    volume:
      private: 2g
      root: 5g

templatevms:
  vars:
    qubes:
      label: gray
      netvm: sys-firewall
      netvm_vm: sys-firewall
      vm_type: TemplateVM
  children:
    primarytemplates:
      hosts:
        archlinux:
        centos-8-minimal:
        centos-8:
        debian-11:
        debian-11-minimal:
        debian-12:
        fedora-36:
        fedora-36-minimal:
        fedora-36-xfce:
        gentoo:
        gentoo-minimal:
        jammy:
        kali:
        whonix-gw-16:
        whonix-ws-16:
    secondarytemplates:
      hosts:
        crypto-template:
        development-template:
        gpg-template:
          qubes:
            template: fedora-36-minimal
            template_vm: fedora-36-minimal
            vm_type: TemplateVM
        media-template:
        personal-template:
        provision-template:
        remote-template:
        swarm-template:
        vpn-template:
          qubes:
            template: fedora-36-minimal
            vm_type: TemplateVM
        vault-template:
          qubes:
            template_vm: fedora-36-minimal
            vm_type: TemplateVM
        work-template:
      vars:
        qubes:
          template: fedora-36
          template_vm: fedora-36
    desktoptemplates:
      hosts:
        archlinux-desktop-template:
        centos-desktop-template:
        debian-desktop-template:
        fedora-desktop-template:
        macos-desktop-template:
        ubuntu-desktop-template:
        windows-desktop-template:
          ansible_connection: winrm
      vars:
        ansible_connection: ssh
        ansible_password: "{{ lookup('env', 'VAGRANT_PASSWORD') }}"
        ansible_user: "{{ lookup('env', 'VAGRANT_USER') }}"
        qubes:
          kernel: ''
          virt_mode: hvm
        volume:
          root: 35g
    hvmtemplates:
      hosts:
        opnsense-template:
          ansible_password: "{{ lookup('env', 'OPNSENSE_PASSWORD') }}"
          ansible_user: "{{ lookup('env', 'OPNSENSE_USER') }}"
          qubes:
            provides_network: true
            pcidevs: '{{ sys_net_pcidevs | default([]) }}'
          volume:
            root: 40g
        pritunl-template:
          ansible_password: "{{ lookup('env', 'PRITUNL_PASSWORD') }}"
          ansible_user: "{{ lookup('env', 'PRITUNL_USER') }}"
          volume:
            root: 10g
        seconion-template:
          ansible_password: "{{ lookup('env', 'SECONION_PASSWORD') }}"
          ansible_user: "{{ lookup('env', 'SECONION_USER') }}"
          volume:
            root: 10g
      vars:
        ansible_connection: ssh
        qubes:
          kernel: ''
          virt_mode: hvm
    dispvmtemplates:
      hosts:
        anonymous-disp:
          qubes:
            template: whonix-ws-16
            template_vm: whonix-ws-16
            services:
              appmenus-dispvm: true
        web-disp:
          qubes:
            services:
              appmenus-dispvm: true
      vars:
        qubes:
          services:
            vm-boot-protect: true
          template: fedora-36
          template_for_dispvms: true
          template_vm: fedora-36
          vm_type: TemplateVM

standalonevms:
  vars:
    qubes:
      label: black
      mem: 4096
      memory: 4096
      maxmem: 8192
      kernel: ''
      vcpus: 4
      virt_mode: hvm
      vm_type: StandaloneVM
  children:
    desktopstandalones:
      hosts:
        archlinux-desktop:
          qubes:
            template: archlinux-desktop-template
            template_vm: archlinux-desktop-template
        centos-desktop:
          qubes:
            template: centos-desktop-template
            template_vm: centos-desktop-template
        debian-desktop:
          qubes:
            template: debian-desktop-template
            template_vm: debian-desktop-template
        fedora-desktop:
          qubes:
            template: fedora-desktop-template
            template_vm: fedora-desktop-template
        macos-desktop:
          qubes:
            template: macos-desktop-template
            template_vm: macos-desktop-template
        ubuntu-desktop:
          qubes:
            template: ubuntu-desktop-template
            template_vm: ubuntu-desktop-template
        windows-desktop:
          ansible_connection: winrm
          qubes:
            template: windows-desktop-template
            template_vm: windows-desktop-template
      vars:
        ansible_connection: ssh
        ansible_password: "{{ lookup('env', 'VAGRANT_PASSWORD') }}"
        ansible_user: "{{ lookup('env', 'VAGRANT_USER') }}"
        qubes:
          netvm: vpn-proton
          netvm_vm: vpn-proton
        volume:
          root: 50g
    networkstandalones:
      hosts:
        pritunl:
          ansible_connection: ssh
          ansible_password: "{{ lookup('env', 'PRITUNL_PASSWORD') }}"
          ansible_user: "{{ lookup('env', 'PRITUNL_USER') }}"
          qubes:
            netvm: opnsense
            netvm_vm: opnsense
            template: pritunl-template
            template_vm: pritunl-template

systemvms:
  hosts:
    anon-whonix:
      qubes:
        netvm: sys-whonix
        netvm_vm: sys-whonix
        services:
          vm-boot-protect: true
          vm-boot-protect-root: false
        template: whonix-ws-16
        template_vm: whonix-ws-16
    sys-firewall:
      qubes:
        netvm: sys-net
        netvm_vm: sys-net
        vm_type: ProxyVM
    sys-net:
    sys-usb:
    sys-whonix:
      qubes:
        netvm: sys-firewall
        netvm_vm: sys-firewall
        services:
          vm-boot-protect: true
          vm-boot-protect-root: false
        template: whonix-gw-16
        template_vm: whonix-gw-16
    whonix-ws-16-dvm:
      qubes:
        netvm: sys-firewall
        netvm_vm: sys-firewall
        services:
          vm-boot-protect: true
          vm-boot-protect-root: false
        template: whonix-ws-16
        template_vm: whonix-ws-16
  vars:
    qubes:
      label: purple
      services:
        vm-boot-protect-root: true
      vm_type: AppVM
